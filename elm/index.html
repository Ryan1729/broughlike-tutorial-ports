<!DOCTYPE html>
<title>AWESOME BROUGHLIKE</title>
<meta charset="UTF-8">
<style>
    canvas{
        outline: 1px solid white;
    }

    body{
        background-color: indigo;
        text-align: center;
        margin-top: 50px;
    }
</style>
<canvas></canvas>
<script>
    spritesheet = new Image();
    spritesheet.src = 'spritesheet.png';

    canvas = document.querySelector("canvas");
    ctx = canvas.getContext("2d");
</script>
<script type="text/javascript" src="elm.js"></script>
<script type="text/javascript">
var app = Elm.Main.init({
    node: document.createElement("dummy"),
    flags: {}
});

const actions = {
    "draw": ({x, y, tileSize}) => {
        ctx.drawImage(spritesheet, x*tileSize, y*tileSize);
    },
    "setCanvasDimensions": ({w, h}) => {
        canvas.width = w;
        canvas.height = h;
        canvas.style.width = canvas.width + 'px';
        canvas.style.height = canvas.height + 'px';
    }
}

app.ports.platform.subscribe((commands) => {
    ctx.clearRect(0,0,1000,1000);
    for (var i = 0; i < commands.length; i += 1) {
        const command = commands[i];
        const action = actions[command.kind];
        if (action) {
            action(command)
        } else {
            console.error(`Unknown command kind: "${command.kind}"`)
        }
    }
});
</script>
